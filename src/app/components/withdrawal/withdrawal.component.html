<div class="page-container">
  <!-- Header -->
  <div class="page-header">
    <button class="back-btn" (click)="goBack()">
      <i class="fas fa-arrow-left"></i>
    </button>
    <h2>Withdrawal</h2>
    <div class="header-icon">
      <i class="fas fa-money-bill-wave"></i>
    </div>
  </div>

  <!-- Loading Spinner -->
  <div *ngIf="isLoading" class="loading-section">
    <div class="loading-spinner">
      <div class="spinner"></div>
      <span>Loading...</span>
    </div>
  </div>

  <!-- Message Card -->
  <div *ngIf="withdrawalMessage" class="message-section">
    <div class="message-card" [ngClass]="withdrawalMessage.type">
      <div class="message-content">
        <i class="fas fa-info-circle" *ngIf="withdrawalMessage.type === 'info'"></i>
        <!-- <i class="fas fa-exclamation-triangle" *ngIf="withdrawalMessage.type === 'warning'"></i> -->
        <i class="fas fa-check-circle" *ngIf="withdrawalMessage.type === 'success'"></i>
        <i class="fas fa-times-circle" *ngIf="withdrawalMessage.type === 'error'"></i>
        <span>{{ withdrawalMessage.text }}</span>
      </div>
      <button *ngIf="withdrawalMessage.text === 'Please set your trade password first.'" class="add-card-link"
        (click)="navigateToSetTradePassword()">
        <i class="fas fa-key"></i>
        Set Trade Password
      </button>
    </div>
  </div>

  <!-- Balance Info -->
  <div class="balance-info">
    <div class="balance-card">
      <div class="balance-header">
        <i class="fas fa-wallet"></i>
        <span>Available Balance</span>
      </div>
      <div class="balance-amount">₹{{availableBalance | number:'1.2-2'}}</div>
      <div class="balance-note">Minimum withdrawal ₹{{minimumWithdrawal}}</div>
    </div>
  </div>

  <!-- Withdrawal Form -->
  <div class="section">
    <div class="section-title">
      <i class="fas fa-money-bill-wave"></i>
      <h3>Withdrawal Application</h3>
    </div>
    <div class="withdrawal-form-card">
      <div class="form-group">
        <label for="withdrawalAmount">
          <i class="fas fa-rupee-sign"></i>
          Withdrawal Amount
        </label>
        <div class="input-wrapper">
          <span class="currency"></span>
          <select id="withdrawalAmount" [(ngModel)]="withdrawalAmount" class="form-input"
            [disabled]="!isTradePasswordSet()">
            <option [ngValue]="null" disabled selected>Select amount</option>
            <option [ngValue]="300">300</option>
            <option [ngValue]="500">500</option>
            <option [ngValue]="1000">1000</option>
            <option [ngValue]="4000">4000</option>
          </select>
          <i class="fas fa-money-bill-wave input-icon"></i>
        </div>
      </div>

      <div class="form-group">
        <label for="tradePassword">
          <i class="fas fa-lock"></i>
          Trade Password
        </label>
        <div class="input-wrapper">
          <input id="tradePassword" type="password" [(ngModel)]="tradePassword" placeholder="Enter your trade password"
            class="form-input" [disabled]="!isTradePasswordSet()">
          <i class="fas fa-key input-icon"></i>
        </div>
      </div>

      <div class="form-group">
        <label for="bankCardSelect">
          <i class="fas fa-credit-card"></i>
          Choose Bank Card
        </label>
        <div class="select-wrapper">
          <select id="bankCardSelect" [(ngModel)]="selectedBankCardId" class="form-input"
            [disabled]="bankCards.length === 0 || !isTradePasswordSet()">
            <option [ngValue]="null" disabled selected>
              {{ bankCards.length > 0 ? 'Select a bank card' : 'No bank cards added' }}
            </option>
            <option *ngFor="let card of bankCards" [ngValue]="card.id">
              {{ card.bank_name }} (A/C: ****{{ card.account_number | slice:-4 }})
            </option>
          </select>
          <i class="fas fa-chevron-down select-icon"></i>
        </div>
        <button *ngIf="bankCards.length === 0" class="add-card-link" (click)="navigateToAddBankCard()">
          <i class="fas fa-plus"></i>
          Add Bank Card
        </button>
      </div>

      <div class="form-actions">
        <button class="apply-btn"
          [disabled]="!isTradePasswordSet() || !withdrawalAmount || !tradePassword || !selectedBankCardId || isLoading"
          (click)="applyWithdrawal()">
          <i class="fas fa-paper-plane"></i>
          Apply Withdrawal
        </button>

        <button class="withdrawal-records-btn" (click)="navigateToWithdrawalRecords()">
          <i class="fas fa-history"></i>
          Withdrawal Records
        </button>
      </div>
    </div>
  </div>

  <!-- Withdrawal Rules -->
  <div class="section">
    <div class="section-title">
      <i class="fas fa-info-circle"></i>
      <h3>Withdrawal Rules</h3>
    </div>
    <div class="rules-card">
      <div class="rule-item" *ngFor="let rule of withdrawalRules; let i = index">
        <div class="rule-number">{{i + 1}}</div>
        <div class="rule-content">
          <i class=""></i>
          <span class="rule-text">{{rule}}</span>
        </div>
      </div>
    </div>
  </div>
</div>